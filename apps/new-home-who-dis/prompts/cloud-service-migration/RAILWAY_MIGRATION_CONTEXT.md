# Railway Migration Context for Documentation Update

## Current State (as of Nov 7, 2025, 8:44 AM EET)

- Static Astro 5 build deployed on Vercel
- NO database configured yet
- NO environment variables set
- NO API endpoints live
- pnpm workspaces monorepo structure
- Subdomain architecture: party.razsbg.top (main) + tv.razsbg.top (TV display)

## Migration Decision

Switched from Vercel to Railway before implementing backend features.

## Key Architecture Changes

### Deployment Platform

**FROM:** Vercel (serverless functions, edge network)
**TO:** Railway (long-running server instances, persistent connections)

### Database

**FROM:** Vercel Postgres (via `vercel postgres create`)
**TO:** Railway PostgreSQL (one-click `railway add`)

**NO CHANGE:** Drizzle ORM still used as database layer

### Subdomain Strategy

**FROM:** Dual Vercel subdomains (party.razsbg.top + tv.razsbg.top)
**TO:** Single Railway deployment with route-based TV display (/tv-display)

**RATIONALE:** Railway serves single app; TV display is a route, not separate subdomain

### Real-time Features

**BENEFIT:** Railway's long-running servers eliminate cold starts and execution time limits for SSE `/api/events` endpoint

### CLI Commands

**FROM:** `vercel`, `vercel --prod`, `vercel postgres create`
**TO:** `railway up`, `railway add`, `railway run`

## Files Requiring Updates

### 1. DEPLOYMENT_GUIDE.md (Major Overhaul)

**Section: "Overview"**

- Remove "separate Vercel project" mention
- Update to "Railway service within monorepo"

**Section: "Subdomain Architecture"**

- **CHANGE:** Remove tv.razsbg.top as separate subdomain
- **NEW APPROACH:** Single domain (party.razsbg.top or housewarming.razsbg.top)
- TV display accessible via route: `https://party.razsbg.top/tv-display`
- Update Samsung TV access instructions accordingly

**Section: "Vercel Project Setup" → "Railway Service Setup"**
Replace entire section:

```


# Old: vercel --name new-home-who-dis

# New: railway init

# Old: Vercel dashboard domain config

# New: Railway custom domain via dashboard/CLI

# Old: POSTGRES_URL from Vercel

# New: DATABASE_URL auto-generated by Railway

```

**Section: "Environment Variables"**

- Update variable name: `POSTGRES_URL` → `DATABASE_URL`
- Note: Railway auto-populates DATABASE_URL when PostgreSQL added

**Section: "Database Setup"**
Replace:

```


# Old: vercel postgres create new-home-who-dis-db

# New: railway add (select PostgreSQL)

# Migrations remain same

pnpm db:generate
pnpm db:migrate

# But run with Railway context

railway run pnpm db:migrate

```

**Section: "Package.json Scripts"**
Update root scripts:

```

{
"scripts": {
"dev:party": "cd apps/new-home-who-dis \&\& pnpm dev",
"build:party": "cd apps/new-home-who-dis \&\& pnpm build",
"deploy:party": "cd apps/new-home-who-dis \&\& railway up"
}
}

```

**Section: "TV Display Route Configuration"**

- Update TV access URL from `tv.razsbg.top` to `party.razsbg.top/tv-display`
- Remove references to separate subdomain
- Note: Single Railway service serves all routes

**Section: "Development Workflow - Deployment"**
Replace:

```


# Old: pnpm vercel / pnpm vercel --prod

# New: railway up (deploys to production)

# For local dev with Railway DB

railway run pnpm dev

```

**Section: "DNS Configuration"**
Simplify to single subdomain:

```


# Old: Two CNAMEs (party + tv)

party.razsbg.top  →  CNAME  →  cname.vercel-dns.com
tv.razsbg.top     →  CNAME  →  cname.vercel-dns.com

# New: One CNAME to Railway

party.razsbg.top  →  CNAME  →  <your-app>.up.railway.app

```

**Section: "Monitoring & Analytics"**
Replace Vercel Analytics with Railway monitoring:

- Railway dashboard metrics (CPU, RAM, network)
- Railway logs (`railway logs`)
- Remove Vercel-specific analytics features
- Keep custom monitoring (unchanged)

**Section: "Security Considerations - CORS"**
Update allowed origins:

```

const allowedOrigins = [
"https://party.razsbg.top",
// Remove: "https://tv.razsbg.top" (now a route)
"http://localhost:4000"
]

```

**Section: "Security Considerations - Rate Limiting"**

- Note: Railway doesn't have built-in edge rate limiting
- Implement via middleware or package (express-rate-limit)
- SSE connections: 2 per user (unchanged)

**Section: "Troubleshooting"**
Update debug commands:

```


# Old: vercel ls, vercel logs, vercel domains ls

# New: railway status, railway logs, railway domain

```

Replace "Vercel function logs" with "Railway service logs"

**Section: "Post-Deployment Checklist"**
Update items:

- [ ] Main subdomain accessible (party.razsbg.top)
- [ ] TV display route working (/tv-display, NOT separate subdomain)
- [ ] Railway PostgreSQL provisioned
- [ ] SSE endpoint tested with persistent connections
- Remove: "Both subdomains accessible" (only one subdomain now)

### 2. TECHNICAL_SPEC.md

**Section: "Tech Stack"**

- Change "Deployment: Vercel" → "Deployment: Railway"
- Change "Database: Vercel Postgres" → "Database: Railway PostgreSQL"
- Keep Drizzle ORM unchanged
- Update "Domain: razsbg.top subdomain" → "Domain: party.razsbg.top (single subdomain with /tv-display route)"

**Section: "Deployment Configuration"**

- Replace Vercel-specific config with Railway setup
- Update environment variable sourcing (Railway auto-generates DATABASE_URL)
- Remove Vercel function timeout configs
- Add Railway service configuration notes

**Section: "Real-time Architecture"**

- Emphasize Railway's advantage for persistent SSE connections
- Note: no 10-second execution limits, no cold starts

### 3. DEVELOPMENT_ROADMAP.md

**Section: "Day 1: Foundation & Core Features - Morning"**

- Change "Set up Vercel Postgres database" → "Set up Railway PostgreSQL database"
- Update initialization: `railway init`, `railway add` (PostgreSQL)

**Section: "Day 3: Polish, Testing & Deployment - Afternoon"**

- Change "Vercel deployment configuration" → "Railway deployment configuration"
- Update deployment steps to use `railway up`
- Modify domain configuration steps for CNAME to Railway
- Update subdomain references (remove tv.razsbg.top, keep party.razsbg.top)

**Section: "Deployment Configuration"**

- Replace Vercel Project Settings with Railway service settings
- Update environment variable management (Railway dashboard vs Vercel)

### 4. prd.md (Minimal Changes)

**Section: "Technical Requirements - Tech Stack Integration"**

- Update "Hosting: Vercel" → "Hosting: Railway"

**Section: "Technical Requirements - Infrastructure"**

- Change CDN note (Railway doesn't have Vercel Edge Network)
- Update monitoring approach (Railway dashboard vs Vercel Analytics)
- Update subdomain mention if applicable

**Section: "Risk Assessment & Mitigation"**

- Update "Vercel deployment issues" → "Railway deployment issues"

## Key Preservation Points

- ALL satirical features, dark patterns, UX elements remain unchanged
- Gift catalog system (Traditional, Receipt, Bandcamp) unchanged
- Anonymous identity system unchanged
- Tier-based leaderboard logic unchanged
- Astro 5 + TypeScript + Tailwind CSS stack unchanged
- Samsung TV compatibility requirements unchanged
- Party date (November 8, 2025, 3 PM) and timeline unchanged
- Monorepo structure unchanged
- TV display functionality unchanged (just route-based now, not subdomain)

## Technical Benefits to Note

- SSE endpoint gets persistent connections (no cold starts)
- No 800-second execution limit on API routes
- Unified PostgreSQL + app infrastructure
- Simpler environment variable management
- Better suited for real-time leaderboard updates during party
- Single Railway service simplifies deployment vs. dual Vercel subdomains

## Configuration Updates Needed

### Environment Variables (Railway)

```

DATABASE_URL=postgresql://... \# Auto-generated by Railway (not POSTGRES_URL)
NODE_ENV=production
REVOLUT_USERNAME=razsbg
PARTY_DATE=2025-11-08

```

### Build Commands (package.json)

```

{
"scripts": {
"start": "npx serve dist"  \# For static serving
}
}

```

### Domain Configuration

- CNAME record from party.razsbg.top → Railway-provided domain
- SSL auto-managed by Railway
- TV display accessed via /tv-display route (not separate subdomain)

### Samsung TV Access

**OLD:** Navigate to `https://tv.razsbg.top/tv-display`
**NEW:** Navigate to `https://party.razsbg.top/tv-display`

## Subdomain Architecture Simplification

**Original (Vercel approach):**

- party.razsbg.top → Main app
- tv.razsbg.top → TV display

**New (Railway approach):**

- party.razsbg.top → Main app
- party.razsbg.top/tv-display → TV display (route, not subdomain)

**Why:** Railway service serves all routes from single deployment. No need for separate subdomain when /tv-display route achieves same goal.

## Timeline Impact

Migration adds ~45-60 minutes but positions better for real-time features before November 8th party.
